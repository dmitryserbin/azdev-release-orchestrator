trigger: none

name: $(Build.DefinitionName)-$(Date:yyyyMMdd)$(Rev:.r)

jobs:
- job: OrchestratorV1
  pool:
    vmImage: windows-latest
  steps:
  - template: template.yml
    parameters:
      name: OrchestratorV1
      path: OrchestratorV1
      restore: true
      build: true
      test: true

- job: OrchestratorV2
  pool:
    vmImage: windows-latest
  steps:
  - template: template.yml
    parameters:
      name: OrchestratorV2
      path: OrchestratorV2
      restore: true
      lint: true
      build: true
      test: true

- job: Extension
  pool:
    vmImage: windows-latest
  dependsOn:
    - OrchestratorV1
    - OrchestratorV2
  steps:
  - task: PowerShell@2
    displayName: Validate extension
    inputs:
      targetType: filePath
      filePath: CI/validate.ps1
      arguments: -Path $(Build.SourcesDirectory) -UpdateBuildNumber
      pwsh: true
